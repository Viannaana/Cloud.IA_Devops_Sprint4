trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  MAVEN_OPTS: '-Xmx1024m'
  DB_URL: 'jdbc:sqlserver://sprint4cloudia.database.windows.net:1433;databaseName=Sprint4CloundIA'
  DB_USER: 'AzureSA'
  DB_PASSWORD: 'CupHead314159265'

steps:
- checkout: self

# Instalar o JDK 17
- script: |
    sudo apt-get update
    sudo apt-get install openjdk-17-jdk -y
  displayName: 'Install JDK 17'

# Definir a vari√°vel JAVA_HOME
- script: |
    echo "##vso[task.setvariable variable=JAVA_HOME;]$(dirname $(dirname $(readlink -f $(which java))))"
  displayName: 'Set JAVA_HOME'

# Executar o Maven para compilar e gerar o JAR
- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'clean package'
    options: '-DskipTests'

# Publicar o arquivo JAR como artefato
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(System.DefaultWorkingDirectory)/target/*.jar'
    artifactName: 'app-jar'
